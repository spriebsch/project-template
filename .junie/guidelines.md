# Containerization

PHP and development tools are installed in a container.

Use

```bash
php-devbox php <script>
```

to execute PHP scripts inside the container.

# Update Autoloaders

Dp not edit autoload.php files. 
Use 

```bash
php-devbox composer dump
```

to update autoloaders.

## Run unit tests

After each task, run all unit tests.
If there are failing tests, fix the production code.

To run all unit tests, use 

```bash
php-devbox phpunit
```


# Static Code Analysis

After each task, run 

```bash
php-devbox composer static-analysis
```

to perform static code analysis with PHPStan.
If errors occur, fix them. 

# Coding Guidelines

Source code is located in `src/` directory
Test files are located in `tests/` directory

Do not edit autoload.php files.
Do not edit files the vendor directory.
Do not edit .gitignore.
Do not edit phpunit.xml.
Do not edit phpstan.neon.
Do not exit composer.json or composer.lock.

Make every concrete class final.
Make classes readonly whenever possible.

Minimum visibility: make every method private by default.
Only make methods public that need to be called from the outside.

Prefer sprintf over variable expansion.
Prefer attributes over docblocks.
Do not create docblocks that are redundant with the type hints.
Only use docblocks to document exceptions thrown.
Use descriptive test method names.
Use the most specific assertion possible.
Use one logical assertion per test method.
Avoid test dependencies.

# General Rules

Never report changes in files or directories that are listed in .gitignore.

Do not edit this file without asking.

# PHPUnit Testing Guidelines

After each task, run all unit tests.
If there are failing tests, fix the production code.
Do not change test code without asking.

## How to Instruct Me to Run Unit Tests

To run all tests:
```bash
php-devbox phpunit
```

### Advanced Test Execution Options

**Verbose output:**
```bash
php-devbox phpunit --verbose
```

**Run specific test files:**
```bash
php-devbox phpunit tests/ParrotTest.php
```

## Writing PHPUnit Tests - Best Practices

### 1. Basic Test Structure
```php
<?php declare(strict_types=1);
use PHPUnit\Framework\TestCase;

final class ExampleTest extends TestCase
{
    public function test_something(): void
    {
        // Arrange
        $object = new ClassUnderTest();
        
        // Act
        $result = $object->method();
        
        // Assert
        $this->assertSame('expected', $result);
    }
}
```

### 2. Using Modern PHPUnit Attributes

**Code Coverage Attributes:**
```php
use PHPUnit\Framework\Attributes\CoversClass;

#[CoversClass(Parrot::class)]
class ParrotTest extends TestCase
{
    // Tests
}
```

### 3. Data Providers with Named Datasets
```php
use PHPUnit\Framework\Attributes\DataProvider;

#[DataProvider('additionProvider')]
public function testAdd(int $a, int $b, int $expected): void
{
    $this->assertSame($expected, $a + $b);
}

public static function additionProvider(): array
{
    return [
        'zeros' => [0, 0, 0],
        'positive numbers' => [1, 2, 3],
        'negative numbers' => [-1, -2, -3],
    ];
}
```

### 6. Test Doubles and Mocking
```php
public function testWithMock(): void
{
    // Create a mock
    $dependency = $this->createMock(DependencyInterface::class);
    
    // Configure mock behavior
    $dependency->method('doSomething')
               ->willReturn('mocked result');
    
    // Use in test
    $object = new ClassUnderTest($dependency);
    $result = $object->performAction();
    
    $this->assertSame('expected result', $result);
}
```

## Common Test Instructions You Can Give Me

### Basic Testing
- "Run the unit tests"
- "Execute PHPUnit tests"
- "Run tests and show output"

### Specific Testing
- "Run only unit tests using `./tools/phpunit --testsuite unit`"
- "Run tests with code coverage using `./tools/phpunit --coverage-text`"
- "Run ParrotTest specifically using `./tools/phpunit tests/ParrotTest.php`"

### Advanced Testing
- "Run tests with verbose output"
- "Generate HTML coverage report"
- "Run tests that cover the Parrot class"

## Test Quality Guidelines

### 1. Test Naming
- Use descriptive test method names
- Follow pattern: `test_methodName_condition_expectedResult`
- Example: `test_speak_whenCalled_returnsNonEmptyString`

### 2. Assertions
- Use specific assertions (`assertSame` vs `assertEquals`)
- One logical assertion per test method
- Use meaningful assertion messages when needed

### 3. Test Independence
- Each test should be independent
- Use `setUp()` and `tearDown()` for common initialization
- Avoid test dependencies unless specifically needed

### 4. Code Coverage
- Aim for high code coverage but focus on meaningful tests
- Use `#[CoversClass]` attribute to document coverage intent
- Use `#[UsesClass]` for collaborators used in unit tests
- Test edge cases and error conditions

### 5. Test Documentation
- Use clear, descriptive test names
- Add comments for complex test scenarios
- Use named data provider datasets for clarity

## Your Current Project Setup
- **Test files**: Located in `tests/` directory
- **Configuration**: `phpunit.xml` with proper bootstrap
- **Source code**: In `src/` directory
- **PHPUnit executable**: Available as `./tools/phpunit`

The project is properly configured and tests are passing successfully!
